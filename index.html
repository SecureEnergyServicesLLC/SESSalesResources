<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Energy - Analytics Portal</title>
    <link rel="icon" type="image/x-icon" href="https://www.sesenergy.org/assets/images/logo-2.jpg">
    <style>
        :root {
            --se-dark-green: #004D40;
            --se-light-green: #3EB489;
            --se-secure-gray: #333F48;
            --se-energy-green: #287233;
            --se-gradient: linear-gradient(135deg, #004D40 0%, #3EB489 100%);
            
            --bg-primary: #0A0E1A;
            --bg-secondary: #131824;
            --bg-tertiary: #1A2030;
            --bg-elevated: #222938;
            
            --text-primary: #FFFFFF;
            --text-secondary: #A0AEC0;
            --text-tertiary: #718096;
            
            --border-color: rgba(255, 255, 255, 0.08);
            --border-light: rgba(255, 255, 255, 0.15);
            
            --accent-success: #00E676;
            --accent-warning: #FFB300;
            --accent-error: #FF5252;
            --accent-info: #00B8D4;
            
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            --transition-base: 0.2s ease;
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        /* Top Bar */
        .top-bar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-img {
            height: 40px;
            width: auto;
            border-radius: var(--radius-md);
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 700;
        }
        
        .logo-text .secure {
            color: var(--se-secure-gray);
            color: #A0AEC0;
        }
        
        .logo-text .energy {
            color: var(--se-light-green);
        }
        
        .top-bar-title {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        /* Main Content */
        .main-content {
            padding: 24px;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        /* Data Status Banner */
        .data-status-banner {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 20px 24px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .data-status-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .data-status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-warning);
            box-shadow: 0 0 8px currentColor;
        }
        
        .data-status-text h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .data-status-text p {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .data-status-right {
            display: flex;
            gap: 32px;
        }
        
        .data-stat {
            text-align: center;
        }
        
        .data-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--se-light-green);
        }
        
        .data-stat-label {
            font-size: 11px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Widgets Grid */
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }
        
        .widget {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .widget-full {
            grid-column: 1 / -1;
        }
        
        .widget-header {
            background: var(--bg-tertiary);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .widget-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 15px;
        }
        
        .widget-title svg {
            color: var(--se-light-green);
        }
        
        .widget-actions {
            display: flex;
            gap: 8px;
        }
        
        .widget-action-btn {
            background: var(--bg-elevated);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
        }
        
        .widget-action-btn:hover {
            background: var(--se-dark-green);
            color: white;
            border-color: var(--se-light-green);
        }
        
        .widget-content {
            flex: 1;
            min-height: 400px;
        }
        
        .widget-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: var(--bg-primary);
        }
        
        /* Notification Toast */
        .notification {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 16px 24px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-size: 14px;
            box-shadow: var(--shadow-lg);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.success {
            border-left: 4px solid var(--accent-success);
        }
        
        .notification.error {
            border-left: 4px solid var(--accent-error);
        }
        
        .notification.info {
            border-left: 4px solid var(--accent-info);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .widgets-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .data-status-banner {
                flex-direction: column;
                text-align: center;
            }
            
            .data-status-right {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="logo-container">
            <img src="https://www.sesenergy.org/assets/images/logo-2.jpg" alt="Secure Energy" class="logo-img">
            <span class="logo-text">
                <span class="secure">SECURE</span>
                <span class="energy">ENERGY</span>
            </span>
        </div>
        <div class="top-bar-title">Analytics Portal</div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Data Status Banner -->
        <div class="data-status-banner">
            <div class="data-status-left">
                <div class="data-status-indicator" id="dataStatusIndicator"></div>
                <div class="data-status-text">
                    <h4 id="dataStatusTitle">LMP Data Status</h4>
                    <p id="dataStatusDesc">Checking data...</p>
                </div>
            </div>
            <div class="data-status-right">
                <div class="data-stat">
                    <div class="data-stat-value" id="dataRecordCount">0</div>
                    <div class="data-stat-label">Records</div>
                </div>
                <div class="data-stat">
                    <div class="data-stat-value" id="dataISOCount">0</div>
                    <div class="data-stat-label">ISOs</div>
                </div>
            </div>
        </div>
        
        <!-- Widgets Grid -->
        <div class="widgets-grid">
            <!-- LMP Data Manager -->
            <div class="widget" data-widget-id="data-manager">
                <div class="widget-header">
                    <div class="widget-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <ellipse cx="12" cy="5" rx="9" ry="3"/>
                            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                            <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                        </svg>
                        <span>LMP Data Manager</span>
                    </div>
                    <div class="widget-actions">
                        <button class="widget-action-btn" title="Pop Out" onclick="popoutWidget('data-manager')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                <polyline points="15 3 21 3 21 9"/>
                                <line x1="10" y1="14" x2="21" y2="3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content" style="height: 500px;">
                    <iframe class="widget-iframe" src="widgets/lmp-data-manager.html" title="LMP Data Manager"></iframe>
                </div>
            </div>
            
            <!-- Arcadia LMP Fetcher -->
            <div class="widget" data-widget-id="arcadia-fetcher">
                <div class="widget-header">
                    <div class="widget-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                        <span>Arcadia LMP Data Fetcher</span>
                    </div>
                    <div class="widget-actions">
                        <button class="widget-action-btn" title="Pop Out" onclick="popoutWidget('arcadia-fetcher')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                <polyline points="15 3 21 3 21 9"/>
                                <line x1="10" y1="14" x2="21" y2="3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content" style="height: 500px;">
                    <iframe class="widget-iframe" src="widgets/arcadia-lmp-fetcher.html" title="Arcadia LMP Fetcher"></iframe>
                </div>
            </div>
            
            <!-- LMP Comparison Portal (Full Width) -->
            <div class="widget widget-full" data-widget-id="lmp-comparison">
                <div class="widget-header">
                    <div class="widget-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"/>
                            <line x1="12" y1="20" x2="12" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="14"/>
                        </svg>
                        <span>LMP Comparison Portal</span>
                    </div>
                    <div class="widget-actions">
                        <button class="widget-action-btn" title="Pop Out" onclick="popoutWidget('lmp-comparison')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                <polyline points="15 3 21 3 21 9"/>
                                <line x1="10" y1="14" x2="21" y2="3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content" style="height: 700px;">
                    <iframe class="widget-iframe" src="widgets/lmp-comparison-portal.html" title="LMP Comparison Portal"></iframe>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification Toast -->
    <div class="notification" id="notification"></div>
    
    <!-- Scripts -->
    <script src="scripts/shared-data-store.js"></script>
    <script>
        // Pop out widget to new window
        function popoutWidget(widgetId) {
            const urls = {
                'arcadia-fetcher': 'widgets/arcadia-lmp-fetcher.html',
                'lmp-comparison': 'widgets/lmp-comparison-portal.html',
                'data-manager': 'widgets/lmp-data-manager.html'
            };
            if (urls[widgetId]) {
                window.open(urls[widgetId], widgetId, 'width=1200,height=800,resizable=yes,scrollbars=yes');
            }
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            notification.textContent = message;
            notification.className = 'notification show ' + type;
            setTimeout(() => notification.classList.remove('show'), 3000);
        }
        
        // Update data status display
        function updateDataStatus() {
            if (typeof SecureEnergyData === 'undefined') return;
            
            try {
                const stats = SecureEnergyData.getStats();
                
                document.getElementById('dataRecordCount').textContent = stats.totalRecords?.toLocaleString() || '0';
                document.getElementById('dataISOCount').textContent = stats.isoCount || '0';
                
                const indicator = document.getElementById('dataStatusIndicator');
                const title = document.getElementById('dataStatusTitle');
                const desc = document.getElementById('dataStatusDesc');
                
                if (stats.totalRecords > 0) {
                    indicator.style.background = 'var(--accent-success)';
                    title.textContent = 'Data Loaded';
                    desc.textContent = `${stats.totalRecords.toLocaleString()} records from ${stats.isoCount} ISOs`;
                } else {
                    indicator.style.background = 'var(--accent-warning)';
                    title.textContent = 'No Data Loaded';
                    desc.textContent = 'Use the Data Manager to load LMP data';
                }
            } catch (e) {
                console.warn('Error updating data status:', e);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Secure Energy Portal initialized');
            
            // Clear any old session data
            localStorage.removeItem('secureEnergy_session');
            
            // Init data store
            if (typeof SecureEnergyData !== 'undefined') {
                SecureEnergyData.init();
                SecureEnergyData.subscribe(() => updateDataStatus());
                updateDataStatus();
            }
        });
        
        // Listen for data updates from widgets
        window.addEventListener('message', function(event) {
            if (event.data?.type === 'LMP_DATA_UPDATE' || event.data?.type === 'LMP_BULK_UPDATE') {
                updateDataStatus();
                showNotification('Data updated!', 'success');
            }
        });
    </script>
</body>
</html>
